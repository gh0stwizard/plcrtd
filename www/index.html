<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="The plcrtd project: OpenSSL Certificate Manager">
  <meta name="keywords" content="perl, knockout, openssl, ca, pkcs, generator, online">
  <meta name="author" content="gh0stwizard">
  <meta charset="utf-8">
  <title>plcrtd &part; OpenSSL Certificate Manager &forall;</title>
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/css/plcrtd.css" type="text/css">
  <script type="text/javascript" src="/js/knockout-3.3.0.js"></script>
  <script type="text/javascript" src="/js/zepto.min.js"></script>
  <script type="text/javascript" src="/js/signals.min.js"></script>
  <script type="text/javascript" src="/js/crossroads.min.js"></script>
  <script type="text/javascript" src="/js/hasher.min.js"></script>
  <script type="text/javascript" src="/js/plcrtd.js"></script>
</head>
<body>
<div class="content">
  <!-- Header :: buttons & loading animation //-->
  <div class="header">
      <button class="btn" data-bind="click: About">About</button>
      <button class="btn" data-bind="click: Configure">Configure</button>
      <button class="btn" data-bind="">Private keys</button>
      <button class="btn" data-bind="">Requests</button>
      <button class="btn" data-bind="">Certificates</button>
      <button class="btn" data-bind="">Revoked</button>
      <!--
      <button class="btn" data-bind="click: CA">CA</button>
      <button class="btn" data-bind="click: Client">Client</button>
      <button class="btn" data-bind="click: PKCS">PKCS</button>
      //-->
      <!-- http://spiffygif.com //-->
      <img src="/img/spiffygif.gif" alt="Loading"
           data-bind="visible: onAJAX()" />
  </div>

  <!-- Error message box //-->
  <div class="errorBox" data-bind="visible: errorMessage()">
    <p><span data-bind="text: errorMessage"></span></p>
    <pre><span data-bind="text: errorDescription"></span></pre>
  </div>

  <!-- About page //-->
  <div class="aboutPage" data-bind="visible: onAbout()">
    <h1>The plcrtd project: OpenSSL Certificate Manager</h1>
    <h2>Description</h2>
    <p>This is an online web certificate manager implemented
       as described in 
       <a title="Mini tutorial for configuring client-side SSL certificates."
          href="https://gist.github.com/mtigas/952344" >howto</a>
          written by 
       <a href="https://gist.github.com/mtigas"
          title="About user mtigas on GitHub">mtigas</a>.
    </p>
    <h2>Goals</h2>
    <ul>
      <li>Provide a service to managing OpenSSL certificates.</li>
      <li>An integration with the
        <a href="http://www.nginx.org" title="nginx website">nginx</a>
        project.</li>
      <li>An interface to send a client certificate via email.</li>
    </ul>
    <h2>Development</h2>
    <p>This is an open source project. Please, checkout sources
      <a href="https://github.com/gh0stwizard/plcrtd"
         title="plcrtd on GitHub">here</a>.</p>
  </div>
  
  <!-- Configuration Page //-->
  <div class="Page" data-bind="visible: onConfigure()">
    <h2>Databases</h2>
    <button class="btn" data-bind="click: tUpdateDB">Create DB</button>
    <button class="btn" data-bind="click: tWipeDBs">Wipe DBs</button>
    <div class="embedView" data-bind="visible: onUpdateDB()">
      <table id="hTable">
        <colgroup><col width="15%"></col></colgroup>
        <tbody>
          <tr>
            <th>Name</th>
            <td class="editable"><input data-bind="value: dbname, enable: !isUpdate()" /></td>
          </tr>
          <tr>
            <th>Description</th>
            <td class="editable"><input data-bind="value: dbdesc" /></td>
          </tr>
          <tr>
            <td class="button">&nbsp;</td>
            <td class="button">
              <button class="btn" data-bind="click: UpdateDBbtn">Submit</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="embedView" data-bind="visible: onWipeDBs()">
      <h3>Attention!</h3>
      <p>By pressing submit button you are accept to wipe 
         all databases from the server.</p>
      <button class="btn" data-bind="click: WipeDBbtn">Submit</button>
    </div>
    <div class="embedView" data-bind="visible: onDBTable() == true && DBList().length > 0">
      <table id="Table">
        <colgroup><col width="15%"><col width="50%"><col><col><col><col></colgroup>
        <thead>
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Status</th>
            <th colspan="3">&nbsp;</th>
          </tr>
        </thead>
        <tbody data-bind="foreach: DBList">
          <tr>
            <td data-bind="text: $data.name"></td>
            <td data-bind="text: $data.desc"></td>
            <td data-bind="text: $data.open"></td>
            <td><a href="#" data-bind="click: $root.openDB" title="Open">Open</a></td>
            <td><a href="#" data-bind="click: $root.editDB" title="Edit">Edit</a></td>
            <td><a href="#" data-bind="click: $root.removeDB" title="Remove">Remove</a></td>
          </tr>
        </tbody>
      </table>
    </div>
    <h2>Settings</h2>
  </div>

  <!-- Certificate Authority Page //-->
  <div class="caPage" data-bind="visible: onCA()">
    <h3>Certificate Authority key</h3>
    <div class="boxSetup">
      <p>Password
      <input size="32" data-bind="value: inCAPassword" /></p>
      <p>Bits
      <select data-bind="options: bitsOptions, value: inCABits"></select></p>
    </div>
    <div class="boxContainer">
      <div class="boxOutput">
        <textarea rows="10" cols="66" data-bind="value: outCAkey"></textarea>
      </div>
      <div class="boxButtonsContainer">
        <button class="btn"
                data-bind="click: genCAkey, enable: genCAkeyReady()">Get!</button>
        <br />
        <button class="btn"
          data-bind="click: save.bind( $data, 'ca.key', outCAkey() ),
                     visible: outCAkey() && browserCheck()">Save</button>
      </div>
    </div>
    <h3>Certificate Authority certificate</h3>
    <p>Please, provide the same password above as you've used for key generation.</p>
    <div class="boxSetup">
      <p>Subject
      <input size="42" class="subj" data-bind="value: inCASubject" /></p>
      <p>Days
      <input size="4" data-bind="value: inCADays" /></p>
    </div>
    <div class="boxContainer">
      <div class="boxOutput">
        <textarea rows="10" cols="66" data-bind="value: outCAcrt"></textarea>
      </div>
      <div class="boxButtonsContainer">
        <button class="btn" data-bind="click: genCAcrt, enable: genCAcrtReady()">Get!</button>
        <br />
        <button class="btn"
          data-bind="click: save.bind( $data, 'ca.crt', outCAcrt() ),
                     visible: outCAcrt() && browserCheck()">Save</button>
      </div>
    </div>
  </div>

  <!-- Client Page //-->
  <div class="clientPage" data-bind="visible: onClient()">
    <h3>Client Certificate key</h3>
    <div class="boxSetup">
      <p>Password
      <input size="32" data-bind="value: inClientPassword" /></p>
      <p>Bits
      <select data-bind="options: bitsOptions, value: inClientBits"></select></p>
    </div>
    <div class="boxContainer">
      <div class="boxOutput">
        <textarea rows="10" cols="66" data-bind="value: outClientKey"></textarea>
      </div>
      <div class="boxButtonsContainer">
        <button class="btn"
                data-bind="click: genClientKey, enable: genClientKeyReady()">Get!</button>
        <br />
        <button class="btn"
          data-bind="click: save.bind( $data, 'client.key', outClientKey() ),
                     visible: outClientKey() && browserCheck()">Save</button>
      </div>
    </div>
    <h3>Client Certificate request</h3>
    <p>Please, provide the same password above as you've used for key generation.</p>
    <div class="boxSetup">
      <p>Subject
      <input size="42" class="subj" data-bind="value: inClientSubject" /></p>
    </div>
    <div class="boxContainer">
      <div class="boxOutput">
        <textarea rows="10" cols="66" data-bind="value: outClientCsr"></textarea>
      </div>
      <div class="boxButtonsContainer">
        <button class="btn"
                data-bind="click: genClientCsr,
                          enable: genClientCsrReady()">Get!</button>
        <br />
        <button class="btn"
          data-bind="click: save.bind( $data, 'client.csr', outClientCsr() ),
                     visible: outClientCsr() && browserCheck()">Save</button>
      </div>
    </div>
    <h3>Client Certificate (self-signed)</h3>
    <div class="boxSetup">
      <p>CA key</p>
      <div class="boxInput">
        <textarea rows="10" cols="66" data-bind="value: inClientCAkey"></textarea>
      </div>
      <p>CA certificate</p>
      <div class="boxInput">
        <textarea rows="10" cols="66" data-bind="value: inClientCAcrt"></textarea>
      </div>
      <p>CA password
      <input size="32" data-bind="value: inClientCAPassword" /></p>
      <p>Days
      <input size="4" data-bind="value: inClientDays" /></p>
      <p>Serial
      <input size="4" data-bind="value: inClientSerial" /></p>
    </div>
    <div class="boxContainer">
      <div class="boxOutput">
        <textarea rows="10" cols="66" data-bind="value: outClientCrt"></textarea>
      </div>
      <div class="boxButtonsContainer">
        <button class="btn"
                data-bind="click: genClientCrt,
                          enable: genClientCrtReady()">Get!</button>
        <br />
        <button class="btn"
          data-bind="click: save.bind( $data, 'client.crt', outClientCrt() ),
                     visible: outClientCrt() && browserCheck()">Save</button>
      </div>
    </div>    
  </div>

  <!-- PKCS Page //-->
  <div class="pkcsPage" data-bind="visible: onPKCS()">
    <h3>PKCS#12 file</h3>
    <div class="boxSetup">
      <p>Client certificate key</p>
      <div class="boxInput">
        <textarea rows="10" cols="66" data-bind="value: inPKCSClientKey"></textarea>
      </div>
      <p>Client certificate</p>
      <div class="boxInput">
        <textarea rows="10" cols="66" data-bind="value: inPKCSClientCrt"></textarea>
      </div>
      <p>Client password
      <input size="16" data-bind="value: inPKCSClientPwd" /></p>
      <p>Export password
      <input size="16" data-bind="value: inPKCSClientXpw" /></p>
    </div>
    <div class="boxContainer">
      <button class="btn" data-bind="click: genP12, enable: genP12Ready()">Get!</button>
    </div>
    <h3>Convert PKCS#12 to PEM</h3>
    <form action="/plcrtd" enctype="multipart/form-data" method="post">
    <div class="boxSetup">
      <p>PKCS#12 file
      <input type="file" class="file" name="p12" /></p>
      <br />
      <p>Password
      <input size="32" name="pwd" data-bind="value: inPKCSpemPwd" /></p>
    </div>
    <div class="boxContainer">
      <input type="hidden" name="action" value="convP12" />
      <input type="submit" class="btn" value="Get!" />
    </div>
    </form>
  </div>

  <div class="footer"></div>

  <iframe style="display: none" id="hframe"></iframe>
</div>
</body>
</html>
